---
import {
  Modal,
  ModalHeader,
  ModalBody,
  ModalFooter,
} from 'free-astro-components';
const projects = [
  {
    title: 'Cultivo de platano',
    location: 'Sierra nevada de Santa Marta, Magdalena',
    description:
      'Implementación de sistema de riego por gravedad en 6 hectáreas de cultivo de plátano, en respuesta a las condiciones de sequía que afectaban la productividad. Se aprovechó la topografía inclinada del terreno para diseñar un sistema eficiente sin necesidad de bombeo.',
    category: 'aspersion',
    image: '/calabazo_riego.webp',
  },
  {
    title: 'Cultivo de pasto de corte',
    location: 'Pedraza, Magdalena',
    description:
      'En una finca de 5 hectáreas dedicada al pastoreo, a pesar de estar ubicada junto al río Magdalena, las condiciones de sequía dificultaban el abastecimiento de agua al cultivo. Se implementó un sistema de riego por aspersión tipo cañón, ideal para terrenos planos y de gran cobertura.',
    category: 'aspersion',
    image: '/riego.webp',
  },
  {
    title: 'Cultivo de palma de aceite',
    location: 'Zona bananera, Magdalena',
    description:
      'Proyecto ejecutado en 60 hectáreas con condiciones críticas de sequía. Se implementó un sistema de riego por tapón perforado, una solución altamente eficiente que permite dirigir el agua directamente a la base de cada planta',
    category: 'tapon',
    image: '/riego1.webp',
  },
  {
    title: 'Cultivo de pasto de corte',
    location: 'Maicao (carraipia), Guajira',
    description:
      'En una extensión de 10 hectáreas destinadas a pasto de corte, se presentaban problemas de sequía constantes, típicos de la región. Se implementó un sistema de riego por aspersión que permitió enfrentar estas condiciones climáticas.',
    category: 'aspersion',
    image: '/riego2.webp',
  },
  {
    title: 'Cultivo de pasto y pastoreo',
    location: 'Calamar, Bolivar',
    description:
      'Proyecto desarrollado en 15 hectáreas dedicadas al pastoreo, en una zona afectada por fuertes periodos de sequía. Se implementó un sistema de riego por aspersión tipo cañón, ideal para grandes extensiones y terrenos planos.',
    category: 'aspersion',
    image: '/riego3.webp',
  },
  {
    title: 'Cultivo de palma de aceite',
    location: 'Algarrobo, Magdalena',
    description:
      'En una plantación de 30 hectáreas de palma de aceite afectada por sequías frecuentes, se implementó un sistema de riego por microtubo, el cual permite aplicar el agua exclusivamente sobre la planta, evitando el riego de malezas y reduciendo el desperdicio.',
    category: 'microtubo',
    image: '/riego4.webp',
  },
];

const categories = [
  { id: 'todos', label: 'Todos' },
  { id: 'aspersion', label: 'Aspersión' },
  { id: 'tapon', label: 'Tapón Perforado' },
  { id: 'microtubo', label: 'Microtubo' },
];
---

<section id="proyectos" class="py-20 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="text-center max-w-3xl mx-auto mb-16" data-aos="fade-up">
      <div class="flex items-center justify-center gap-2 mb-4">
        <div class="h-1 w-12 bg-primary"></div>
        <h2 class="text-lg font-medium text-primary">Nuestros Proyectos</h2>
        <div class="h-1 w-12 bg-primary"></div>
      </div>

      <h3 class="text-3xl md:text-4xl font-bold mb-6">
        Transformando la Agricultura en la Costa Caribe
      </h3>

      <p class="text-gray-700">
        Conozca algunos de nuestros proyectos más destacados, donde hemos
        implementado soluciones de riego eficientes adaptadas a las necesidades
        específicas de cada cliente.
      </p>
    </div>

    <!-- Filter Buttons -->
    <div class="flex flex-wrap justify-center gap-3 mb-12" data-aos="fade-up">
      {
        categories.map((category) => (
          <button
            type="button"
            class="filter-btn px-4 py-2 rounded-md text-sm font-medium transition-colors duration-300 bg-white border border-gray-200 hover:bg-primary hover:text-white"
            data-category={category.id}
          >
            {category.label}
          </button>
        ))
      }
    </div>

    <!-- Projects Grid -->
    <div
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 project-grid"
    >
      {
        projects.map((project, index) => (
          <div
            class="project-item bg-white rounded-lg overflow-hidden shadow-lg transition-transform duration-300 hover:-translate-y-2"
            data-category={project.category}
            data-aos="fade-up"
            data-aos-delay={index * 100}
          >
            <div class="relative overflow-hidden h-64">
              <img
                src={project.image}
                alt={project.title}
                class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
              />
            </div>

            <div class="p-6">
              <div class="flex justify-between items-start mb-3">
                <h4 class="text-xl font-bold">{project.title}</h4>
                <span class="bg-primary/10 text-primary text-xs px-3 py-1 rounded-full font-medium">
                  {project.category === 'aspersion'
                    ? 'Aspersión'
                    : project.category === 'tapon'
                      ? 'Tapón Perforado'
                      : project.category === 'microtubo'
                        ? 'Microtubo'
                        : ''}
                </span>
              </div>

              <p class="text-gray-500 text-sm mb-4">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 inline-block mr-1"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                </svg>
                {project.location}
              </p>

              <p class="text-gray-700 mb-6 line-clamp-3">
                {project.description}
              </p>

              <button
                data-modal-trigger={`modal-proyecto-${index}`}
                class="view-project-btn text-primary hover:text-primary-dark font-medium inline-flex items-center transition duration-300 group"
                type="button"
              >
                Ver detalles
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 ml-2 group-hover:translate-x-1 transition-transform"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
            </div>

            {/* Modal para este proyecto */}
            <Modal id={`modal-proyecto-${index}`} size="2xl" tabindex="-1">
              <ModalHeader>
                <h4>{project.title}</h4>
              </ModalHeader>
              <ModalBody>
                <img
                  src={project.image}
                  alt={project.title}
                  class="w-full h-50 object-cover rounded mb-4"
                />
                <p class="text-gray-500 text-sm mb-2">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 inline-block mr-1"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                  {project.location}
                </p>
                <p class="text-gray-700">{project.description}</p>
                <span class="block mt-4 bg-primary/10 text-primary text-xs px-3 py-1 rounded-full font-medium w-max">
                  {project.category === 'aspersion'
                    ? 'Aspersión'
                    : project.category === 'tapon'
                      ? 'Tapón Perforado'
                      : project.category === 'microtubo'
                        ? 'Microtubo'
                        : ''}
                </span>
              </ModalBody>
              <ModalFooter>
                <button
                  data-modal-close
                  type="button"
                  class="px-4 py-2 rounded bg-primary text-white font-medium hover:bg-primary-dark transition"
                >
                  Cerrar
                </button>
              </ModalFooter>
            </Modal>
          </div>
        ))
      }
    </div>

    <div class="text-center mt-12" data-aos="fade-up">
      <a
        href="#contacto"
        class="inline-block bg-primary hover:bg-primary-dark text-white font-medium py-3 px-6 rounded-md transition duration-300 shadow-lg"
      >
        Solicitar una Visita Técnica
      </a>
    </div>
  </div>
</section>

<script>
  // Project filtering functionality
  document.addEventListener('DOMContentLoaded', () => {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const projectItems = document.querySelectorAll('.project-item');

    // Set "Todos" as active by default
    const allButton = document.querySelector('[data-category="todos"]');
    if (allButton) {
      allButton.classList.add('bg-primary', 'text-white');
      allButton.classList.remove('bg-white');
    }

    filterBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        // Remove active class from all buttons
        filterBtns.forEach((b) => {
          b.classList.remove('bg-primary', 'text-white');
          b.classList.add('bg-white');
        });

        // Add active class to clicked button
        btn.classList.add('bg-primary', 'text-white');
        btn.classList.remove('bg-white');

        const category = btn.getAttribute('data-category');

        // Show/hide projects based on category
        projectItems.forEach((item) => {
          if (
            category === 'todos' ||
            item.getAttribute('data-category') === category
          ) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
      });
    });
  });

  document.addEventListener('astro:after-swap', () => {
    // Si usas Astro Islands, puedes necesitar este evento
    document.body.style.overflow = '';
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      // Espera un pequeño tiempo para que el modal se cierre
      setTimeout(() => {
        document.body.style.overflow = '';
      }, 100);
    }
  });
</script>
